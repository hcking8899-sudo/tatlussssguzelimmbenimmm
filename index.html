<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Seni Bekliyorum G√ºzelim ‚ú®</title>
    <style>
        :root { --bg: #050505; --heart: #ff4d6d; --gold: #ffd700; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--bg); overflow: hidden; touch-action: none; font-family: 'Poppins', sans-serif; transition: background 2.5s ease; }

        /* El Feneri */
        #flashlight { position: fixed; inset: 0; background: radial-gradient(circle 140px at center, transparent 10%, rgba(0,0,0,0.99) 85%); z-index: 9999; pointer-events: none; transition: opacity 2s ease; }
        .star { position: absolute; background: white; border-radius: 50%; pointer-events: none; z-index: 9998; animation: starFade 0.8s forwards; }
        @keyframes starFade { from { opacity: 1; transform: scale(1); } to { opacity: 0; transform: scale(0); } }

        /* Oyun Alanƒ± */
        #game-area { width: 100%; height: 100%; position: relative; z-index: 100; }
        #chest-container { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 200px; height: 200px; }
        
        #chest-left, #chest-right { position: absolute; width: 50%; height: 100%; transition: all 2.5s cubic-bezier(0.4, 0, 0.2, 1); z-index: 60; }
        #chest-left { left: 0; }
        #chest-right { right: 0; }
        
        .heart-half { width: 200px; height: 200px; fill: var(--heart); filter: drop-shadow(0 0 15px var(--heart)); }
        #chest-right .heart-half { margin-left: -100px; }

        .key { position: absolute; width: 55px; height: 55px; cursor: grab; filter: drop-shadow(0 0 12px gold); z-index: 110; }

        /* Altƒ±n Anahtar */
        #inner-key { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0); width: 110px; height: 110px; z-index: 55; transition: all 3s ease; opacity: 0; filter: drop-shadow(0 0 40px gold); }

        /* Mesaj Alanƒ± */
        #note-overlay { position: fixed; top: 15%; width: 100%; text-align: center; color: white; font-size: 1.3rem; font-weight: bold; z-index: 10000; pointer-events: none; text-shadow: 0 0 20px var(--heart); padding: 0 30px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; min-height: 4em; }

        /* Emojiler */
        .falling-emoji { position: fixed; font-size: 85px; z-index: 20000; pointer-events: none; animation: slowEmoji 4s linear forwards; opacity: 0; }
        @keyframes slowEmoji { 0% { transform: translateY(110vh) rotate(0); opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { transform: translateY(-20vh) rotate(360deg); opacity: 0; } }

        /* Final Ekranƒ± */
        #final { position: fixed; inset: 0; display: none; flex-direction: column; align-items: center; justify-content: center; background: radial-gradient(circle, #fff0f3, #ffb7c5); z-index: 30000; opacity: 0; transition: opacity 2s ease; }
        .final-box { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); padding: 45px 30px; border-radius: 35px; max-width: 85%; text-align: center; border: 2px solid white; box-shadow: 0 20px 60px rgba(216, 0, 50, 0.15); }
        .final-text { color: #d80032; font-size: 1.8rem; font-weight: 800; line-height: 1.5; }
        .cursor { display: inline-block; width: 3px; height: 1.2em; background-color: var(--heart); margin-left: 5px; animation: blink 1s infinite; vertical-align: middle; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
    </style>
</head>
<body>

<div id="flashlight"></div>
<div id="note-overlay"></div>

<div id="game-area">
    <div id="chest-container">
        <div id="inner-key">
            <svg viewBox="0 0 24 24" fill="gold"><path d="M12.65 10C11.83 7.67 9.61 6 7 6c-3.31 0-6 2.69-6 6s2.69 6 6 6c2.61 0 4.83-1.67 5.65-4H17v4h4v-4h2v-4H12.65zM7 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></svg>
        </div>
        <div id="chest-left">
            <svg class="heart-half" viewBox="0 0 32 32"><path d="M16 28.5L14.1 26.8C7.33 20.66 2.5 16.28 2.5 11C2.5 6.58 5.92 3.17 10.33 3.17C12.83 3.17 15.22 4.33 16.75 6.17V28.5Z"/></svg>
        </div>
        <div id="chest-right">
            <svg class="heart-half" viewBox="0 0 32 32"><path d="M16 6.17C17.53 4.33 19.92 3.17 22.42 3.17C26.83 3.17 30.25 6.58 30.25 11C30.25 16.28 25.42 20.66 18.65 26.8L16.75 28.5V6.17Z"/></svg>
        </div>
    </div>
</div>

<div id="final">
    <div class="final-box">
        <div id="typewriter-final" class="final-text"></div>
    </div>
</div>

<script>
    const flashlight = document.getElementById('flashlight');
    const noteOverlay = document.getElementById('note-overlay');
    const innerKey = document.getElementById('inner-key');
    const final = document.getElementById('final');
    let found = 0;
    let typeInterval;

    const msgs = [
        "Bu anahtarr seninn d√ºnyaalaarrr g√ºzelliƒüinii temsill ediyo g√ºzelimmm",
        "Bu anahtar senin tatlu≈ü≈üluƒüunu temsil ediyo g√ºzelimmm",
        "Bu anahtar seni √ßooookkkk sevdiƒüimi temsil ediyo g√ºzelimmm",
        "Bu anahtar da seni g√∂r√ºnce beni temsil ediyo g√ºzelimmm"
    ];

    const handleMove = (e) => {
        const x = e.clientX || (e.touches ? e.touches[0].clientX : window.innerWidth/2);
        const y = e.clientY || (e.touches ? e.touches[0].clientY : window.innerHeight/2);
        flashlight.style.background = `radial-gradient(circle 140px at ${x}px ${y}px, transparent 10%, rgba(0,0,0,0.99) 85%)`;
        if (Math.random() > 0.8) {
            const s = document.createElement('div');
            s.className = 'star';
            s.style.left = x + 'px'; s.style.top = y + 'px';
            document.body.appendChild(s);
            setTimeout(() => s.remove(), 800);
        }
    };
    window.onmousemove = handleMove; window.ontouchmove = handleMove;

    const pos = [{t:'12%',l:'12%'}, {t:'85%',l:'10%'}, {t:'15%',l:'88%'}, {t:'80%',l:'85%'}];
    pos.forEach((p, i) => {
        const k = document.createElement('div');
        k.className = 'key';
        k.style.top = p.t; k.style.left = p.l;
        k.innerHTML = `<svg viewBox="0 0 24 24" fill="gold"><path d="M12.65 10C11.83 7.67 9.61 6 7 6c-3.31 0-6 2.69-6 6s2.69 6 6 6c2.61 0 4.83-1.67 5.65-4H17v4h4v-4h2v-4H12.65zM7 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></svg>`;
        makeDrag(k, i);
        document.body.appendChild(k);
    });

    function makeDrag(el, idx) {
        let startX, startY;
        const start = (e) => {
            startX = e.clientX || e.touches[0].clientX; startY = e.clientY || e.touches[0].clientY;
            document.onmousemove = drag; document.ontouchmove = drag;
            document.onmouseup = stop; document.ontouchend = stop;
        };
        const drag = (e) => {
            const cx = e.clientX || (e.touches ? e.touches[0].clientX : 0);
            const cy = e.clientY || (e.touches ? e.touches[0].clientY : 0);
            el.style.top = (el.offsetTop - (startY - cy)) + "px";
            el.style.left = (el.offsetLeft - (startX - cx)) + "px";
            startX = cx; startY = cy;
            const r1 = el.getBoundingClientRect(), r2 = document.getElementById('chest-container').getBoundingClientRect();
            if (!(r1.right < r2.left || r1.left > r2.right || r1.bottom < r2.top || r1.top > r2.bottom)) {
                el.remove(); found++; trigger();
                document.onmousemove = null; document.ontouchmove = null;
            }
        };
        const stop = () => { document.onmousemove = null; document.ontouchmove = null; };
        el.onmousedown = start; el.ontouchstart = start;
    }

    function trigger() {
        if (navigator.vibrate) navigator.vibrate(50);
        clearInterval(typeInterval);
        noteOverlay.innerHTML = "";
        
        let text = msgs[found-1];
        let i = 0;
        typeInterval = setInterval(() => {
            noteOverlay.innerHTML += text[i];
            i++;
            if (i >= text.length) {
                clearInterval(typeInterval);
                if(found === 4) {
                    // S√ñZ Bƒ∞TTƒ∞ƒûƒ∞ AN: Emojiler ba≈ülar
                    startEmojiSequence(); 
                } else {
                    setTimeout(() => { if(noteOverlay.innerHTML === text) noteOverlay.innerHTML = ""; }, 2000);
                }
            }
        }, 50);
    }

    function startEmojiSequence() {
        // Emojiler s√ºz√ºlmeye ba≈ülar (Daha yava≈ü ve b√ºy√ºk)
        for(let i=0; i<40; i++) {
            setTimeout(() => {
                const e = document.createElement('div');
                e.className = 'falling-emoji';
                e.innerText = Math.random() > 0.5 ? 'üòç' : 'ü´†';
                e.style.left = Math.random() * 95 + 'vw';
                document.body.appendChild(e);
                setTimeout(() => e.remove(), 4000);
            }, i * 100);
        }

        // Emojiler ba≈üladƒ±ktan kƒ±sa s√ºre sonra sandƒ±k a√ßƒ±lmaya ba≈ülar
        setTimeout(openChest, 1000);
    }

    function openChest() {
        // Ekran aydƒ±nlanƒ±r
        flashlight.style.opacity = "0"; 
        document.body.style.background = "#fff0f3";
        
        // Sandƒ±k ikiye ayrƒ±lƒ±r
        document.getElementById('chest-left').style.transform = 'translateX(-130px) rotate(-25deg)';
        document.getElementById('chest-right').style.transform = 'translateX(130px) rotate(25deg)';
        
        // Altƒ±n anahtar y√ºkselir
        innerKey.style.opacity = '1';
        innerKey.style.transform = 'translate(-50%, -180%) scale(1.8)';

        // Final ekranƒ±na ge√ßi≈ü
        setTimeout(() => {
            final.style.display = 'flex';
            setTimeout(() => {
                final.style.opacity = '1';
                typeWriterFinal();
            }, 100);
        }, 3500);
    }

    function typeWriterFinal() {
        const fMsg = "Kalbimin anahtarƒ±nƒ± buldunn d√ºnyalarrrr g√ºzelimmm benimmm üòç ü´∂ü´∂ü´∂";
        let i = 0;
        const target = document.getElementById('typewriter-final');
        const timer = setInterval(() => {
            target.innerHTML += fMsg.charAt(i);
            i++;
            if(i >= fMsg.length) {
                clearInterval(timer);
                target.innerHTML += '<span class="cursor"></span>';
            }
        }, 80);
    }
</script>
</body>
</html>
